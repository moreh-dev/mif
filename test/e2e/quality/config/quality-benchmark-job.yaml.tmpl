apiVersion: batch/v1
kind: Job
metadata:
  generateName: quality-benchmark-
  labels:
    app: quality-benchmark
  namespace: {{.Namespace}}
spec:
  template:
    metadata:
      labels:
        app: quality-benchmark
        sidecar.istio.io/inject: "false"
    spec:
      restartPolicy: Never
      imagePullSecrets:
        - name: {{ .ImagePullSecret }}
      containers:
      - name: quality-benchmark
        image: {{ .QualityBenchmarkImage }}
        args:
        - --eval
        - "{{.Benchmarks}}"
        - --model
        - "{{.ModelName}}"
        - --host
        - "{{.GatewayHost}}"
        - --port
        - "{{.GatewayPort}}"
        {{- if not .IsKind }}
        volumeMounts:
          - name: model
            mountPath: /mnt/models
        {{- end }}
        env:
          {{- if not .IsKind }}
          - name: HF_HOME
            value: /mnt/models
          {{- end }}
          {{- if .HFToken }}
          - name: HF_TOKEN
            value: "{{ .HFToken }}"
          {{- end }}
          {{- if .HFEndpoint }}
          - name: HF_ENDPOINT
            value: "{{ .HFEndpoint }}"
          {{- end }}
          {{- if .Limit }}
          - name: LIMIT
            value: "{{.Limit}}"
          {{- end }}
      {{- if not .IsKind }}
      volumes:
        - name: model
          persistentVolumeClaim:
            claimName: model
      {{- end }}
